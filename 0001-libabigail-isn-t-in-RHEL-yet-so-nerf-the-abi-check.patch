From 7b0bd868dc58657799bd14eb471efe7f62d875a2 Mon Sep 17 00:00:00 2001
From: Peter Jones <pjones@redhat.com>
Date: Fri, 8 Jun 2018 15:08:21 -0400
Subject: [PATCH] libabigail isn't in RHEL yet, so nerf the abi check.

Signed-off-by: Peter Jones <pjones@redhat.com>
---
 Make.defaults  |  2 --
 Make.rules     | 11 -----------
 Makefile       | 12 ++++--------
 efivar.spec.in |  7 +------
 4 files changed, 5 insertions(+), 27 deletions(-)

diff --git a/Make.defaults b/Make.defaults
index 57cee6e82b5..9ee5c80f910 100644
--- a/Make.defaults
+++ b/Make.defaults
@@ -24,8 +24,6 @@ LDFLAGS := $(LDFLAGS)
 AR	:= $(CROSS_COMPILE)$(COMPILER)-ar
 NM	:= $(CROSS_COMPILE)$(COMPILER)-nm
 RANLIB	:= $(CROSS_COMPILE)$(COMPILER)-ranlib
-ABIDW	:= abidw
-ABIDIFF := abidiff
 
 PKGS	=
 
diff --git a/Make.rules b/Make.rules
index 042585b533c..585e287f455 100644
--- a/Make.rules
+++ b/Make.rules
@@ -23,17 +23,6 @@ include $(TOPDIR)/Make.version
 	  -o $@ $^ $(LDLIBS)
 	ln -vfs $@ $@.1
 
-%.abixml : %.so
-	$(ABIDW) --headers-dir $(TOPDIR)/src/include/efivar/ --out-file $@ $^
-	@sed -i -s 's,$(TOPDIR)/,,g' $@
-
-%.abicheck : %.so
-	$(ABIDIFF) \
-		--suppr abignore \
-		--headers-dir2 $(TOPDIR)/src/include/efivar/ \
-		$(patsubst %.so,%.abixml,$<) \
-		$<
-
 %.o : %.c
 	$(CC) $(cflags) -fPIC $(CPPFLAGS) -c -o $@ $(filter %.c %.o %.S,$^)
 
diff --git a/Makefile b/Makefile
index 8c67b9d2654..e4f76a3a8d4 100644
--- a/Makefile
+++ b/Makefile
@@ -20,13 +20,9 @@ install :
 		$(MAKE) -C $$x $@ ; \
 	done
 
-abidw abicheck efivar efivar-static static:
+efivar efivar-static static:
 	$(MAKE) -C src $@
 
-abiupdate :
-	$(MAKE) clean all
-	$(MAKE) -C src abiclean abixml
-
 $(SUBDIRS) :
 	$(MAKE) -C $@
 
@@ -39,7 +35,7 @@ a :
 		exit 1 ; \
 	fi
 
-.PHONY: $(SUBDIRS) a brick abiupdate
+.PHONY: $(SUBDIRS) a brick
 
 GITTAG = $(shell bash -c "echo $$(($(VERSION) + 1))")
 
@@ -51,7 +47,7 @@ clean :
 	done
 	@rm -vf efivar.spec
 
-test-archive: abicheck efivar.spec
+test-archive: efivar.spec
 	@rm -rf /tmp/efivar-$(GITTAG) /tmp/efivar-$(GITTAG)-tmp
 	@mkdir -p /tmp/efivar-$(GITTAG)-tmp
 	@git archive --format=tar $(shell git branch | awk '/^*/ { print $$2 }') | ( cd /tmp/efivar-$(GITTAG)-tmp/ ; tar x )
@@ -70,7 +66,7 @@ bumpver :
 tag:
 	git tag -s $(GITTAG) refs/heads/master
 
-archive: abicheck bumpver abidw tag efivar.spec
+archive: bumpver tag efivar.spec
 	@rm -rf /tmp/efivar-$(GITTAG) /tmp/efivar-$(GITTAG)-tmp
 	@mkdir -p /tmp/efivar-$(GITTAG)-tmp
 	@git archive --format=tar $(GITTAG) | ( cd /tmp/efivar-$(GITTAG)-tmp/ ; tar x )
diff --git a/efivar.spec.in b/efivar.spec.in
index 180e5374ae6..b55329b265d 100644
--- a/efivar.spec.in
+++ b/efivar.spec.in
@@ -7,7 +7,7 @@ URL:            https://github.com/rhinstaller/efivar
 Requires:       %{name}-libs = %{version}-%{release}
 ExclusiveArch:  %{ix86} x86_64 aarch64
 
-BuildRequires:  git glibc-static libabigail
+BuildRequires:  git glibc-static
 Source0:        https://github.com/rhboot/efivar/archive/%{version}.tar.gz
 
 %description
@@ -47,11 +47,6 @@ rm -rf $RPM_BUILD_ROOT
 %clean
 rm -rf $RPM_BUILD_ROOT
 
-%check
-%ifarch x86_64
-make abicheck
-%endif
-
 %post libs -p /sbin/ldconfig
 
 %postun libs -p /sbin/ldconfig
-- 
2.17.1

